

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Docker 2 &mdash; Scientific Containers CRG PhD Course 2024  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
    <link rel="canonical" href="https://biocorecrg.github.io/PhD_course_containers_2024/docker_2.html" />
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=5929fcd5"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Singularity" href="singularity.html" />
    <link rel="prev" title="Docker" href="docker.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Scientific Containers CRG PhD Course 2024
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="containers.html">Containers</a></li>
<li class="toctree-l1"><a class="reference internal" href="docker.html">Docker</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Docker 2</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#docker-recipes-build-your-images">Docker recipes: build your images</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#os-commands-in-image-building">OS commands in image building</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#update-and-upgrade-packages">Update and upgrade packages</a></li>
<li class="toctree-l4"><a class="reference internal" href="#search-and-install-packages">Search and install packages</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#building-recipes">Building recipes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#basic-instructions">Basic instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#docker-build">docker build</a></li>
<li class="toctree-l4"><a class="reference internal" href="#more-instructions">More instructions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#docker-tag">docker tag</a></li>
<li class="toctree-l3"><a class="reference internal" href="#build-exercise">Build exercise</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="singularity.html">Singularity</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Scientific Containers CRG PhD Course 2024</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Docker 2</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/docker_2.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="docker-2">
<span id="docker-2-page"></span><h1>Docker 2<a class="headerlink" href="#docker-2" title="Link to this heading"></a></h1>
<section id="docker-recipes-build-your-images">
<h2>Docker recipes: build your images<a class="headerlink" href="#docker-recipes-build-your-images" title="Link to this heading"></a></h2>
<section id="os-commands-in-image-building">
<h3>OS commands in image building<a class="headerlink" href="#os-commands-in-image-building" title="Link to this heading"></a></h3>
<p>Depending on the underlying OS, there are different ways to build images.</p>
<p>Know your base system and its packages. Popular ones:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://packages.debian.org">Debian</a></p></li>
<li><p><a class="reference external" href="https://centos.pkgs.org/">CentOS</a></p></li>
<li><p><a class="reference external" href="https://pkgs.alpinelinux.org/packages">Alpine</a></p></li>
<li><p>Conda. <a class="reference external" href="https://anaconda.org/anaconda/repo">Anaconda</a>, <a class="reference external" href="https://conda-forge.org/feedstocks/">Conda-forge</a>, <a class="reference external" href="https://anaconda.org/bioconda/repo">Bioconda</a>, etc.</p></li>
</ul>
<section id="update-and-upgrade-packages">
<h4>Update and upgrade packages<a class="headerlink" href="#update-and-upgrade-packages" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>In <strong>Ubuntu</strong>:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">update</span> <span class="o">&amp;&amp;</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">upgrade</span> <span class="o">-</span><span class="n">y</span>
</pre></div>
</div>
<ul class="simple">
<li><p>In <strong>CentOS</strong>:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">yum</span> <span class="n">check</span><span class="o">-</span><span class="n">update</span> <span class="o">&amp;&amp;</span> <span class="n">yum</span> <span class="n">update</span> <span class="o">-</span><span class="n">y</span>
</pre></div>
</div>
</section>
<section id="search-and-install-packages">
<h4>Search and install packages<a class="headerlink" href="#search-and-install-packages" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>In <strong>Ubuntu</strong>:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">apt</span> <span class="n">search</span> <span class="n">libxml2</span>
<span class="n">apt</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">libxml2</span><span class="o">-</span><span class="n">dev</span>
</pre></div>
</div>
<ul class="simple">
<li><p>In <strong>CentOS</strong>:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">yum</span> <span class="n">search</span> <span class="n">libxml2</span>
<span class="n">yum</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">libxml2</span><span class="o">-</span><span class="n">devel</span><span class="o">.</span><span class="n">x86_64</span>
</pre></div>
</div>
<p>Note the <strong>-y</strong> option that we set for updating and for installing.&lt;br&gt;
It is an important option in the context of Docker: it means that you <em>answer yes to all questions</em> regarding installation.</p>
</section>
</section>
<section id="building-recipes">
<h3>Building recipes<a class="headerlink" href="#building-recipes" title="Link to this heading"></a></h3>
<p>All commands should be saved in a text file, named by default <strong>Dockerfile</strong>.</p>
<section id="basic-instructions">
<h4>Basic instructions<a class="headerlink" href="#basic-instructions" title="Link to this heading"></a></h4>
<p>Each row in the recipe corresponds to a <strong>layer</strong> of the final image.</p>
<p><strong>FROM</strong>: parent image. Typically, an operating system. The <strong>base layer</strong>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FROM</span> <span class="n">ubuntu</span><span class="p">:</span><span class="mf">24.04</span>
</pre></div>
</div>
<p><strong>RUN</strong>: the command to execute inside the image filesystem.</p>
<p>Think about it this way: every <strong>RUN</strong> line is essentially what you would run to install programs on a freshly installed Ubuntu OS.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">RUN</span> <span class="n">apt</span> <span class="n">install</span> <span class="n">wget</span>
</pre></div>
</div>
<p>A basic recipe:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FROM</span> <span class="n">ubuntu</span><span class="p">:</span><span class="mf">24.04</span>

<span class="n">RUN</span> <span class="n">apt</span> <span class="n">update</span> <span class="o">&amp;&amp;</span> <span class="n">apt</span> <span class="o">-</span><span class="n">y</span> <span class="n">upgrade</span>
<span class="n">RUN</span> <span class="n">apt</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">wget</span>
</pre></div>
</div>
</section>
<section id="docker-build">
<h4>docker build<a class="headerlink" href="#docker-build" title="Link to this heading"></a></h4>
<p>Implicitely looks for a <strong>Dockerfile</strong> file in the current directory:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">docker build .</span>
</pre></div>
</div>
<p>Same as:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">docker build --file Dockerfile .</span>
</pre></div>
</div>
<p>Syntax: <strong>–file / -f</strong></p>
<p><strong>.</strong> stands for the build process’s context (in this case, the current directory). This makes sense if copying files from the filesystem, for instance. <strong>IMPORTANT</strong>: Avoid contexts (directories) overpopulated with files (even if they are not used in the recipe).</p>
<p>You can define a specific name for the image during the build process.</p>
<p>Syntax: <strong>-t</strong> <em>imagename:tag</em>. If not defined <code class="docutils literal notranslate"><span class="pre">`:tag`</span></code> default is latest.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">docker build -t mytestimage .</span>
<span class="gp"># </span>Same<span class="w"> </span>as:
<span class="go">docker build -t mytestimage:latest .</span>
</pre></div>
</div>
<p><strong>IMPORTANT: Avoid contexts (directories) over-populated with files (even if not used in the recipe).</strong></p>
<p>To avoid some directories or files being inspected or included (e.g., with COPY command in Dockerfile), you can use the .dockerignore file to specify which paths should be avoided. More information at: <a class="reference external" href="https://codefresh.io/docker-tutorial/not-ignore-dockerignore-2/">https://codefresh.io/docker-tutorial/not-ignore-dockerignore-2/</a></p>
<p>The last installation line should be <strong>Successfully built …</strong>: you are good to go.</p>
<p>Check with <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">images</span></code> to see if the newly built image is on the list…</p>
<p>Then, let’s check the ID of the image and run it!</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">docker images</span>

<span class="go">docker run f9f41698e2f8</span>
<span class="go">docker run mytestimage</span>
</pre></div>
</div>
</section>
<section id="more-instructions">
<h4>More instructions<a class="headerlink" href="#more-instructions" title="Link to this heading"></a></h4>
<p><strong>WORKDIR</strong>: all subsequent actions will be executed in that working directory</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">WORKDIR</span> <span class="o">~</span>
</pre></div>
</div>
<p><strong>ADD, COPY</strong>: add files to the image filesystem</p>
<p>Difference between ADD and COPY explained <a class="reference external" href="https://stackoverflow.com/questions/24958140/what-is-the-difference-between-the-copy-and-add-commands-in-a-dockerfile">here</a> and <a class="reference external" href="https://nickjanetakis.com/blog/docker-tip-2-the-difference-between-copy-and-add-in-a-dockerile">here</a></p>
<p><strong>COPY</strong>: lets you copy a local file or directory from your host (the machine from which you are building the image)</p>
<p><strong>ADD</strong>: The same, but ADD also works for URLs and .tar archives that will be automatically extracted upon being copied.</p>
<p>If we have a file, let’s say <code class="docutils literal notranslate"><span class="pre">`example.jpg`</span></code>, we can copy it.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># COPY source destination</span>
<span class="n">COPY</span> <span class="n">example</span><span class="o">.</span><span class="n">jpg</span> <span class="o">.</span>
</pre></div>
</div>
<p>A more sophisticated case:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FROM</span> <span class="n">ubuntu</span><span class="p">:</span><span class="mf">24.04</span>

<span class="n">RUN</span> <span class="n">apt</span> <span class="n">update</span> <span class="o">&amp;&amp;</span> <span class="n">apt</span> <span class="o">-</span><span class="n">y</span> <span class="n">upgrade</span>
<span class="n">RUN</span> <span class="n">apt</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">wget</span>

<span class="n">RUN</span> <span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="o">/</span><span class="n">data</span>

<span class="n">WORKDIR</span> <span class="o">/</span><span class="n">data</span>

<span class="n">COPY</span> <span class="n">example</span><span class="o">.</span><span class="n">jpg</span> <span class="o">.</span>
</pre></div>
</div>
<p><strong>ENV, ARG</strong>: run and build environment variables</p>
<p>Difference between ARG and ENV explained <a class="reference external" href="https://vsupalov.com/docker-arg-vs-env/">here</a>.</p>
<ul class="simple">
<li><p><strong>ARG</strong> values: available only while the image is built.</p></li>
<li><p><strong>ENV</strong> values: available during the image build process and for future running containers.
* It can be checked in a resulting running container by running <code class="docutils literal notranslate"><span class="pre">env</span></code>.</p></li>
</ul>
<p><strong>CMD, ENTRYPOINT</strong>: command to execute when generated container starts</p>
<p>The ENTRYPOINT specifies a command that will always be executed when the container starts. The CMD specifies arguments that will be fed to the ENTRYPOINT</p>
<p>In the example below, when the container is run without an argument, it will execute <cite>echo “hello world”</cite>.
If it is run with the argument <strong>hello moon</strong> it will execute <cite>echo “hello moon”</cite></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FROM</span> <span class="n">ubuntu</span><span class="p">:</span><span class="mf">24.04</span>
<span class="n">ENTRYPOINT</span> <span class="p">[</span><span class="s2">&quot;/bin/echo&quot;</span><span class="p">]</span>
<span class="n">CMD</span> <span class="p">[</span><span class="s2">&quot;hello world&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>A more complex recipe (save it in a text file named <strong>Dockerfile</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FROM</span> <span class="n">ubuntu</span><span class="p">:</span><span class="mf">24.04</span>

<span class="n">WORKDIR</span> <span class="o">/</span><span class="n">data</span>

<span class="n">RUN</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">update</span> <span class="o">&amp;&amp;</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="o">-</span><span class="n">y</span> <span class="n">upgrade</span>
<span class="n">RUN</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">wget</span>

<span class="n">ENTRYPOINT</span> <span class="p">[</span><span class="s2">&quot;/usr/bin/wget&quot;</span><span class="p">]</span>
<span class="n">CMD</span> <span class="p">[</span><span class="s2">&quot;https://upload.wikimedia.org/wikipedia/commons/4/4d/Cat_November_2010-1a.jpg&quot;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">docker build -t downloadimg .</span>
<span class="go">mkdir images</span>
<span class="go">docker run -v $(pwd)/images:/data downloadimg</span>
<span class="go">docker run -v $(pwd)/images:/data downloadimg https://upload.wikimedia.org/wikipedia/commons/1/11/Canis_lupus_familiaris.002_-_Monfero.jpg</span>
</pre></div>
</div>
</section>
</section>
<section id="docker-tag">
<h3>docker tag<a class="headerlink" href="#docker-tag" title="Link to this heading"></a></h3>
<p>To tag a local image with ID “e23aaea5dff1” into the “ubuntu_wget” image name repository with version “1.0”:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">docker tag e23aaea5dff1 ubuntu_wget:1.0</span>
</pre></div>
</div>
</section>
<section id="build-exercise">
<h3>Build exercise<a class="headerlink" href="#build-exercise" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Random numbers</p></li>
<li><p>Copy the following short bash script in a file called random_numbers.sh.</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span>!/usr/bin/bash
<span class="go">seq 1 1000 | shuf | head -$1</span>
</pre></div>
</div>
<p>This script outputs random integers from 1 to 1000; the number of integers selected is given as the first argument.</p>
<ul class="simple">
<li><p>Write a recipe for an image:</p>
<ul>
<li><p>Based on centos:7</p></li>
<li><p>That will execute this script (with bash) when it is run, giving it 2 as a default argument (i.e. outputs 2 random integers): the default can be changed as the image is run.</p></li>
<li><p>Build the image.</p></li>
<li><p>Start a container with the default argument, then try it with another argument.</p></li>
</ul>
</li>
</ul>
<details>
<summary><a>Suggested solution</a></summary><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FROM</span> <span class="n">centos</span><span class="p">:</span><span class="mi">7</span>

<span class="c1"># Copy script from host to image</span>
<span class="n">COPY</span> <span class="n">random_numbers</span><span class="o">.</span><span class="n">bash</span> <span class="o">.</span>

<span class="c1"># Make script executable (optional)</span>
<span class="c1"># Alternative ways to do this: https://stackoverflow.com/questions/56558570/copying-files-with-execute-permissions-in-docker-image</span>
<span class="n">RUN</span> <span class="n">chmod</span> <span class="o">+</span><span class="n">x</span> <span class="n">random_numbers</span><span class="o">.</span><span class="n">bash</span>

<span class="c1"># As the container starts, &quot;random_numbers.sh&quot; is run</span>
<span class="c1"># If executable /usr/bin/bash not strictly needed</span>
<span class="n">ENTRYPOINT</span> <span class="p">[</span><span class="s2">&quot;/usr/bin/bash&quot;</span><span class="p">,</span> <span class="s2">&quot;random_numbers.sh&quot;</span><span class="p">]</span>

<span class="c1"># default argument (that can be changed on the command line)</span>
<span class="n">CMD</span> <span class="p">[</span><span class="s2">&quot;2&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>Build and run:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">docker build -f Dockerfile_RN -t random_numbers .</span>
<span class="go">docker run random_numbers</span>
<span class="go">docker run random_numbers 10</span>
</pre></div>
</div>
</details></section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="docker.html" class="btn btn-neutral float-left" title="Docker" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="singularity.html" class="btn btn-neutral float-right" title="Singularity" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright .</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>